<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Grid-It Lab - Text-Kitchen</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .grid-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            table-layout: fixed;
        }

        .grid-table td {
            border: 1px solid #c0c0c0;
            padding: 15px;
            vertical-align: top;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            background: #ffffff;
        }

        .grid-table td:empty {
            background: #f5f5f5;
        }

        .number-input-group {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .number-input-item {
            flex: 1;
            min-width: 200px;
        }

        .number-input-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .number-input-item input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #4a4a4a;
            font-size: 1em;
            background: #ffffff;
        }

        .number-input-item input[type="number"]:focus {
            outline: none;
            border-color: #c41e3a;
        }

        .words-per-cell-group {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <nav class="main-nav">
        <a href="index.html">Home</a>
        <a href="text-reverse-lab.html">Text Reversal</a>
        <a href="line-break-lab.html">Line Break Lab</a>
        <a href="eraser-lab.html">Eraser Lab</a>
        <a href="alphabetizer-lab.html">Alphabetizer Lab</a>
        <a href="markov-mashup-lab.html">Markov Mashup Lab</a>
        <a href="lipogram-lab.html">Lipogram Lab</a>
        <a href="long-tail-lab.html">Long Tail Lab</a>
        <a href="grid-it-lab.html">Grid-It Lab</a>
        <a href="about.html">About</a>
    </nav>

    <div class="container">
        <div class="header">
            <h1>Grid-It Lab</h1>
            <p>Organize text into a customizable grid with adjustable rows and columns</p>
        </div>

        <p style="margin-bottom: 30px; line-height: 1.8; color: #4a4a4a;">
            [Add your description here about how the Grid-It Lab creates visual arrangements of text and its applications for spatial poetry or experimental layouts.]
        </p>

        <div class="upload-section">
            <div class="upload-icon">ðŸ“„</div>
            <h2>Upload Text File</h2>
            <p>Select a .txt file to organize into a grid</p>
            <label class="file-input-wrapper">
                Choose File
                <input type="file" id="textFile" accept=".txt" />
            </label>
        </div>

        <div class="options-section" id="optionsSection" style="display: none;">
            <div class="option-group">
                <h3>Grid Dimensions</h3>
                <div class="number-input-group">
                    <div class="number-input-item">
                        <label for="columnsInput">Columns (leave empty for auto, max 10):</label>
                        <input type="number" id="columnsInput" min="1" max="50" placeholder="Auto (max 10)" />
                    </div>
                    <div class="number-input-item">
                        <label for="rowsInput">Rows (leave empty for auto):</label>
                        <input type="number" id="rowsInput" min="1" placeholder="Auto" />
                    </div>
                </div>
            </div>

            <div class="option-group words-per-cell-group">
                <h3>Words Per Cell</h3>
                <div class="checkbox-container">
                    <input type="checkbox" id="fitAllCheckbox" />
                    <label for="fitAllCheckbox">Fit All (divide evenly across grid)</label>
                </div>
                <div class="slider-container" id="wordsPerCellContainer">
                    <div class="slider-label">
                        <span>Words per cell:</span>
                        <span id="wordsPerCellValue">1</span>
                    </div>
                    <input type="range" id="wordsPerCellSlider" class="slider" min="1" max="20" value="1" step="1">
                </div>
            </div>

            <div class="option-group">
                <h3>Reading Direction</h3>
                <div class="radio-group">
                    <label class="radio-option" for="ltr">
                        <input type="radio" id="ltr" name="direction" value="ltr" checked />
                        <span>Left-to-Right</span>
                    </label>
                    <label class="radio-option" for="rtl">
                        <input type="radio" id="rtl" name="direction" value="rtl" />
                        <span>Right-to-Left</span>
                    </label>
                </div>
            </div>

            <button class="apply-btn" id="generateBtn">Generate Grid</button>
        </div>

        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="output-header">
                <div class="output-title">Grid View</div>
            </div>
            <div id="gridContainer"></div>
            <div class="stats" id="statsDisplay"></div>
        </div>
    </div>

    <script>
        let fileContent = '';
        let words = [];

        const fileInput = document.getElementById('textFile');
        const optionsSection = document.getElementById('optionsSection');
        const generateBtn = document.getElementById('generateBtn');
        const resultsSection = document.getElementById('resultsSection');
        const gridContainer = document.getElementById('gridContainer');
        const statsDisplay = document.getElementById('statsDisplay');

        fileInput.addEventListener('change', handleFileUpload);
        generateBtn.addEventListener('click', generateGrid);

        // Add event listeners for radio buttons
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', updateRadioStyles);
        });

        // Initialize radio button styles
        updateRadioStyles();

        function updateRadioStyles() {
            document.querySelectorAll('.radio-option').forEach(option => {
                const radio = option.querySelector('input[type="radio"]');
                if (radio.checked) {
                    option.classList.add('checked');
                } else {
                    option.classList.remove('checked');
                }
            });
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];

            if (file) {
                if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        fileContent = e.target.result;
                        words = fileContent.split(/\s+/).filter(word => word.trim().length > 0);
                        optionsSection.style.display = 'block';
                        resultsSection.style.display = 'none';
                        generateBtn.disabled = false;
                    };
                    reader.onerror = function(e) {
                        console.error('Error reading file:', e);
                        alert('Error reading file. Please try again.');
                    };
                    reader.readAsText(file);
                } else {
                    alert('Please select a valid .txt file');
                }
            }
        }

        function generateGrid() {
            if (words.length === 0) {
                alert('Please upload a text file first');
                return;
            }

            const columnsInput = document.getElementById('columnsInput').value;
            const rowsInput = document.getElementById('rowsInput').value;
            const fitAllChecked = document.getElementById('fitAllCheckbox').checked;
            const wordsPerCellSliderValue = parseInt(document.getElementById('wordsPerCellSlider').value);
            const direction = document.querySelector('input[name="direction"]:checked').value;

            let columns, rows, wordsPerCell;

            // Calculate grid dimensions
            if (fitAllChecked) {
                // "Fit All" mode: divide words evenly
                columns = columnsInput ? parseInt(columnsInput) : 10;
                rows = rowsInput ? parseInt(rowsInput) : Math.ceil(words.length / columns);
                const totalCells = columns * rows;
                wordsPerCell = Math.ceil(words.length / totalCells);
            } else {
                // Specific words per cell from slider
                wordsPerCell = wordsPerCellSliderValue;
                const totalWordsNeeded = words.length;
                const cellsNeeded = Math.ceil(totalWordsNeeded / wordsPerCell);

                if (columnsInput && rowsInput) {
                    columns = parseInt(columnsInput);
                    rows = parseInt(rowsInput);
                } else if (columnsInput) {
                    columns = parseInt(columnsInput);
                    rows = Math.ceil(cellsNeeded / columns);
                } else if (rowsInput) {
                    rows = parseInt(rowsInput);
                    columns = Math.ceil(cellsNeeded / rows);
                } else {
                    // Default: max 10 columns, calculate rows
                    columns = Math.min(10, cellsNeeded);
                    rows = Math.ceil(cellsNeeded / columns);
                }
            }

            // Create the grid
            const table = document.createElement('table');
            table.className = 'grid-table';

            let wordIndex = 0;
            const totalCells = columns * rows;

            for (let row = 0; row < rows; row++) {
                const tr = document.createElement('tr');

                for (let col = 0; col < columns; col++) {
                    const td = document.createElement('td');

                    // Determine actual column index based on reading direction
                    const actualCol = direction === 'rtl' ? (columns - 1 - col) : col;

                    // Fill cells top-to-bottom, then left-to-right (or right-to-left)
                    const cellIndex = actualCol * rows + row;

                    if (wordsPerCellValue === 'fit') {
                        // Fit all mode: distribute evenly
                        const startIdx = cellIndex * wordsPerCell;
                        const endIdx = Math.min(startIdx + wordsPerCell, words.length);
                        const cellWords = words.slice(startIdx, endIdx);
                        td.textContent = cellWords.join(' ');
                    } else {
                        // Specific words per cell
                        const cellWords = [];
                        for (let i = 0; i < wordsPerCell; i++) {
                            const idx = cellIndex * wordsPerCell + i;
                            if (idx < words.length) {
                                cellWords.push(words[idx]);
                            }
                        }
                        td.textContent = cellWords.join(' ');
                    }

                    tr.appendChild(td);
                }

                table.appendChild(tr);
            }

            gridContainer.innerHTML = '';
            gridContainer.appendChild(table);

            // Calculate statistics
            const wordsUsed = fitAllChecked
                ? words.length
                : Math.min(words.length, totalCells * wordsPerCell);
            const wordsNotUsed = words.length - wordsUsed;

            statsDisplay.innerHTML = `
                <strong>Grid Size:</strong> ${columns} columns Ã— ${rows} rows (${totalCells} cells)<br>
                <strong>Words Per Cell:</strong> ${fitAllChecked ? `~${wordsPerCell} (average)` : wordsPerCell}<br>
                <strong>Total Words:</strong> ${words.length}<br>
                <strong>Words in Grid:</strong> ${wordsUsed}<br>
                ${wordsNotUsed > 0 ? `<strong>Words Not Displayed:</strong> ${wordsNotUsed}<br>` : ''}
                <strong>Reading Direction:</strong> ${direction === 'ltr' ? 'Left-to-Right' : 'Right-to-Left'}
            `;

            resultsSection.style.display = 'block';
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Words per cell slider
        const wordsPerCellSlider = document.getElementById('wordsPerCellSlider');
        const wordsPerCellValue = document.getElementById('wordsPerCellValue');
        const wordsPerCellContainer = document.getElementById('wordsPerCellContainer');
        const fitAllCheckbox = document.getElementById('fitAllCheckbox');

        if (wordsPerCellSlider && wordsPerCellValue) {
            wordsPerCellSlider.addEventListener('input', (e) => {
                wordsPerCellValue.textContent = e.target.value;
            });
        }

        if (fitAllCheckbox && wordsPerCellContainer) {
            fitAllCheckbox.addEventListener('change', (e) => {
                wordsPerCellContainer.style.opacity = e.target.checked ? '0.5' : '1';
                wordsPerCellSlider.disabled = e.target.checked;
            });
        }

    </script>
</body>
</html>
